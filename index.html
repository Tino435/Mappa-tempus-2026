<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Mappa Interattiva - Tempus 2026</title>
    
    <script src="https://unpkg.com/@panzoom/panzoom@4.5.1/dist/panzoom.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/image-map-resizer/1.0.10/js/imageMapResizer.min.js"></script>

    <style>
        :root { --medieval-blue: #2c3e50; --gold: #f1c40f; --parchment: #e0d7c6; }
        
        body { margin: 0; display: flex; height: 100vh; font-family: 'Georgia', serif; background: var(--parchment); overflow: hidden; }

        /* Pulsante Hamburger (solo Mobile) */
        .hamburger {
            display: none;
            position: fixed;
            top: 15px;
            left: 15px;
            z-index: 1000;
            background: var(--medieval-blue);
            border: 2px solid var(--gold);
            border-radius: 5px;
            padding: 8px 10px;
            cursor: pointer;
            flex-direction: column;
            gap: 4px;
        }
        .hamburger span { display: block; width: 22px; height: 3px; background: var(--gold); }

        /* Sidebar Legenda */
        .sidebar { width: 320px; background: var(--medieval-blue); color: white; padding: 20px; overflow-y: auto; z-index: 999; box-shadow: 2px 0 15px rgba(0,0,0,0.5); flex-shrink: 0; transition: transform 0.3s ease; }
        .sidebar h2 { font-size: 1.2rem; border-bottom: 2px solid var(--gold); padding-bottom: 10px; color: var(--gold); text-transform: uppercase; margin-top: 0; }
        .sidebar h3 { font-size: 0.9rem; color: #aaa; margin-top: 25px; text-transform: uppercase; border-bottom: 1px solid #444; }
        
        .legend-list { padding: 0; list-style: none; margin: 0; }
        .legend-item { cursor: pointer; padding: 10px 0; border-bottom: 1px solid rgba(255,255,255,0.1); font-size: 0.9rem; transition: 0.2s; }
        .legend-item:hover { color: var(--gold); padding-left: 8px; }

        /* Area Mappa */
        .map-viewport { flex-grow: 1; position: relative; overflow: hidden; background: #ccd5de; cursor: grab; display: flex; justify-content: center; align-items: center; touch-action: none; }
        .map-viewport:active { cursor: grabbing; }
        #panzoom-element { display: flex; justify-content: center; align-items: center; }
        #panzoom-element img { max-width: 100%; height: auto; display: block; }

        /* MODIFICHE PER MOBILE */
        @media (max-width: 768px) {
            .hamburger { display: flex; }
            .sidebar {
                position: fixed;
                left: 0;
                top: 0;
                height: 100vh;
                transform: translateX(-100%); /* Nasconde a sinistra */
            }
            .sidebar.active { transform: translateX(0); } /* Mostra menu */
            .map-viewport { width: 100vw; height: 100vh; }
        }

        /* Popup Modale */
        .modal { display: none; position: fixed; z-index: 1001; left: 0; top: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); }
        .modal-content { background: #fdfaf0; margin: 20% auto; padding: 25px; width: 80%; max-width: 400px; border-radius: 8px; text-align: center; border: 4px solid var(--medieval-blue); position: relative; }
        .close { position: absolute; right: 15px; top: 5px; font-size: 35px; cursor: pointer; color: var(--medieval-blue); }
    </style>
</head>
<body>

<button class="hamburger" onclick="toggleMenu()">
    <span></span><span></span><span></span>
</button>

<div class="sidebar" id="sidebarMenu">
    <h2>I Luoghi della Festa</h2>
    <ul class="legend-list">
        <li class="legend-item" onclick="showInfo('Antro et Locanda de lo Duomo', '‚ù∂ Ristoro medievale situato sotto le volte del Duomo.')">‚ù∂ Antro et Locanda de lo Duomo</li>
        <li class="legend-item" onclick="showInfo('Cort dal Diaul', '‚ù∑ Punto di ristoro suggestivo tra le mura storiche.')">‚ù∑ Cort dal Diaul</li>
        <li class="legend-item" onclick="showInfo('Cervogeria de lo Eretico', '‚ù∏ Produzione artigianale di birre ed elisir.')">‚ù∏ Cervogeria de lo Eretico</li>
        <li class="legend-item" onclick="showInfo('Taberna de lo Rospo', '‚ùπ Osteria tipica per viandanti e cavalieri.')">‚ùπ Taberna de lo Rospo</li>
        <li class="legend-item" onclick="showInfo('Porta Paninorum', '‚ù∫ Antico varco ora sede di sapori tradizionali.')">‚ù∫ Porta Paninorum</li>
        <li class="legend-item" onclick="showInfo('Taberna Pane et Salamen', '‚ùª Specialit√† locali e taglieri del borgo.')">‚ùª Taberna Pane et Salamen</li>
    </ul>

    <h3>Eventi e Attrazioni</h3>
    <ul class="legend-list">
        <li class="legend-item" onclick="showInfo('Incendio del Campanile', '‚òÖ Spettacolo pirotecnico ogni sera.')">‚òÖ Incendio del Campanile</li>
        <li class="legend-item" onclick="showInfo('Palio / Dama Vivente', 'üèÅ Venerd√¨ 1: Palio. Luned√¨ 4: Dama Vivente (Piazza del Ferro).')">üèÅ Palio / Dama Vivente</li>
        <li class="legend-item" onclick="showInfo('Antro delle Torture', '‚õì Esposizione di strumenti di giustizia medievale.')">‚õì Antro delle Torture</li>
        <li class="legend-item" onclick="showInfo('Accampamento', '‚õ∫ Vita quotidiana, tende e addestramento armigeri.')">‚õ∫ Accampamento</li>
        <li class="legend-item" onclick="showInfo('Salita delle Cartomanti', 'üåô Scopri il tuo futuro tra stelle e tarocchi.')">üåô Salita delle Cartomanti</li>
        <li class="legend-item" onclick="showInfo('Cortile dei Nobili', 'üëë Luogo di ritrovo per l\'aristocrazia del borgo.')">üëë Cortile dei Nobili</li>
        <li class="legend-item" onclick="showInfo('Mercati', 'üß∫ Banchi di artigianato e mercanzie d\'altri tempi.')">üß∫ Mercati</li>
    </ul>

    <h3>Servizi</h3>
    <ul class="legend-list">
        <li class="legend-item" onclick="showInfo('Cambio Monete', 'üí∞ Cambia qui i tuoi Euro in moneta medievale.')">üí∞ Cambio Monete</li>
        <li class="legend-item" onclick="showInfo('Infopoint / WC', '‚ìò Informazioni, programmi e WC con fasciatoio.')">‚ìò Infopoint / WC</li>
        <li class="legend-item" onclick="showInfo('Salvacondotto', '‚öî Punto di controllo e informazioni.')">‚öî Salvacondotto</li>
    </ul>
</div>

<div class="map-viewport">
    <div id="panzoom-element">
        <img src="mappa.jpg" usemap="#festa-map" id="map-image">
        <map name="festa-map">
            </map>
    </div>
</div>

<div id="infoModal" class="modal">
    <div class="modal-content">
        <span class="close" onclick="closeModal()">&times;</span>
        <h2 id="modal-title" style="color:var(--medieval-blue); margin-top:0;"></h2>
        <hr style="border:0; border-top:1px solid #ccc; margin:15px 0;">
        <p id="modal-text" style="line-height:1.6; color:#333;"></p>
    </div>
</div>

<script>
    // 1. Inizializzazione Zoom
    const elem = document.getElementById('panzoom-element');
    const panzoom = Panzoom(elem, {
        maxScale: 4,
        minScale: 0.5,
        contain: 'outside',
        startScale: 0.7
    });

    elem.parentElement.addEventListener('wheel', panzoom.zoomWithWheel);

    window.onload = function() {
        setTimeout(() => {
            panzoom.zoom(0.7, { animate: true });
            panzoom.pan(0, 0, { animate: true });
            imageMapResize();
        }, 300);
    };

    // 2. Gestione Menu Hamburger
    function toggleMenu() {
        document.getElementById('sidebarMenu').classList.toggle('active');
    }

    // 3. Funzione Popup
    function showInfo(title, text) {
        document.getElementById('modal-title').innerText = title;
        document.getElementById('modal-text').innerText = text;
        document.getElementById('infoModal').style.display = "block";
        
        // Chiude il menu dopo la selezione su mobile
        if (window.innerWidth <= 768) {
            document.getElementById('sidebarMenu').classList.remove('active');
        }
    }

    function closeModal() {
        document.getElementById('infoModal').style.display = "none";
    }

    // Chiudi modale cliccando fuori
    window.onclick = function(event) {
        if (event.target == document.getElementById('infoModal')) closeModal();
    }
</script>

</body>
</html>